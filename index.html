<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mirindra Chat</title>
  <style>
    #chat-box {
      border: 1px solid #ccc;
      height: 300px;
      overflow-y: scroll;
      padding: 10px;
      margin-bottom: 10px;
    }
    #dropZone {
      border: 2px dashed #ccc;
      padding: 20px;
      text-align: center;
      margin-bottom: 10px;
    }
    #dropZone.hover {
      border-color: #333;
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>

  <h1>Mirindra Chat</h1>
  <h3>Par Andrianarivelo Njara Mirindra Nirina</h3>

  <div id="auth">
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Mot de passe" required />
    <button id="registerBtn">Créer un compte</button>
    <button id="loginBtn">Se connecter</button>
    <button id="logoutBtn" style="display:none;">Déconnexion</button>
  </div>

  <div id="messaging" style="display:none;">
    <h3>Bienvenue, <span id="currentUserEmail"></span></h3>
    <div id="adminNotice"></div>

    <input type="text" id="recipient" placeholder="Destinataire (email)" required />
    <div id="chat-box"></div>

    <form id="chat-form">
      <input type="text" id="message" placeholder="Votre message" required />
      <button type="submit">Envoyer</button>
    </form>

    <input type="file" id="fileInput" multiple />
    <div id="dropZone">Glissez vos fichiers ici</div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "mxrxndrv756",
      authDomain: "mxrxndrv-messenger.mimi.com",
      projectId: "mxrxndrv-message",
      storageBucket: "mimi.com",
      messagingSenderId: "19215678",
      appId: "1:19215678:mimi:mxr12mi89"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const storage = firebase.storage();

    // DOM
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const registerBtn = document.getElementById("registerBtn");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const chatForm = document.getElementById("chat-form");
    const messageInput = document.getElementById("message");
    const recipientInput = document.getElementById("recipient");
    const chatBox = document.getElementById("chat-box");
    const fileInput = document.getElementById("fileInput");
    const dropZone = document.getElementById("dropZone");
    const messagingDiv = document.getElementById("messaging");
    const currentUserEmail = document.getElementById("currentUserEmail");
    const adminNotice = document.getElementById("adminNotice");

    let currentUser = null;

    // Auth
    registerBtn.onclick = () => {
      auth.createUserWithEmailAndPassword(emailInput.value, passwordInput.value)
        .then(() => alert("Compte créé avec succès."))
        .catch(err => alert(err.message));
    };

    loginBtn.onclick = () => {
      auth.signInWithEmailAndPassword(emailInput.value, passwordInput.value)
        .catch(err => alert(err.message));
    };

    logoutBtn.onclick = () => auth.signOut();

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        messagingDiv.style.display = "block";
        logoutBtn.style.display = "inline";
        currentUserEmail.textContent = user.email;

        // Marquage admin
        if (user.email === "mxrxndrv@gmail.com") {
          adminNotice.innerHTML = "<strong style='color:red;'>Connecté en tant qu'Administrateur</strong>";
        } else {
          adminNotice.innerHTML = "";
        }

        listenToMessages(user.email);
      } else {
        messagingDiv.style.display = "none";
        logoutBtn.style.display = "none";
        currentUser = null;
      }
    });

    // Envoi message
    chatForm.addEventListener("submit", function(e) {
      e.preventDefault();
      const message = messageInput.value;
      const recipient = recipientInput.value;

      db.collection("messages").add({
        sender: currentUser.email,
        recipient,
        message,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      messageInput.value = "";
    });

    // Afficher messages
    function listenToMessages(userEmail) {
      db.collection("messages")
        .where("recipient", "==", userEmail)
        .orderBy("timestamp")
        .onSnapshot(snapshot => {
          chatBox.innerHTML = "";
          snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement("div");
            div.textContent = `${data.sender} : ${data.message}`;
            chatBox.appendChild(div);
          });
        });
    }

    // Drag & drop
    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.classList.add("hover");
    });
    dropZone.addEventListener("dragleave", () => dropZone.classList.remove("hover"));
    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.classList.remove("hover");
      handleFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener("change", (e) => handleFiles(e.target.files));

    function handleFiles(files) {
      Array.from(files).forEach(file => {
        const maxSize = 50 * 1024 * 1024;
        if (file.size <= maxSize) {
          uploadFile(file);
        } else {
          const excess = file.size - maxSize;
          const mo = Math.ceil(excess / (10 * 1024 * 1024)) * 10;
          const price = (mo / 10) * 500;
          alert(`Le fichier "${file.name}" dépasse 50Mo.\nMontant à payer : ${price} Ar\nPayez via MVola au numéro 0340894299.`);
        }
      });
    }

    function uploadFile(file) {
      const ref = storage.ref(`uploads/${currentUser.uid}/${file.name}`);
      ref.put(file)
        .then(() => alert(`Fichier "${file.name}" envoyé avec succès.`))
        .catch(err => alert("Erreur : " + err.message));
    }
  </script>
</body>
</html><!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mirindra Chat</title>
  <style>
    #chat-box {
      border: 1px solid #ccc;
      height: 300px;
      overflow-y: scroll;
      padding: 10px;
      margin-bottom: 10px;
    }
    #dropZone {
      border: 2px dashed #ccc;
      padding: 20px;
      text-align: center;
      margin-bottom: 10px;
    }
    #dropZone.hover {
      border-color: #333;
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>

  <h1>Mirindra Chat</h1>
  <h3>Par Andrianarivelo Njara Mirindra Nirina</h3>

  <div id="auth">
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Mot de passe" required />
    <button id="registerBtn">Créer un compte</button>
    <button id="loginBtn">Se connecter</button>
    <button id="logoutBtn" style="display:none;">Déconnexion</button>
  </div>

  <div id="messaging" style="display:none;">
    <h3>Bienvenue, <span id="currentUserEmail"></span></h3>
    <div id="adminNotice"></div>

    <input type="text" id="recipient" placeholder="Destinataire (email)" required />
    <div id="chat-box"></div>

    <form id="chat-form">
      <input type="text" id="message" placeholder="Votre message" required />
      <button type="submit">Envoyer</button>
    </form>

    <input type="file" id="fileInput" multiple />
    <div id="dropZone">Glissez vos fichiers ici</div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "mxrxndrv756",
      authDomain: "mxrxndrv-messenger.mimi.com",
      projectId: "mxrxndrv-message",
      storageBucket: "mimi.com",
      messagingSenderId: "19215678",
      appId: "1:19215678:mimi:mxr12mi89"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const storage = firebase.storage();

    // DOM
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const registerBtn = document.getElementById("registerBtn");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const chatForm = document.getElementById("chat-form");
    const messageInput = document.getElementById("message");
    const recipientInput = document.getElementById("recipient");
    const chatBox = document.getElementById("chat-box");
    const fileInput = document.getElementById("fileInput");
    const dropZone = document.getElementById("dropZone");
    const messagingDiv = document.getElementById("messaging");
    const currentUserEmail = document.getElementById("currentUserEmail");
    const adminNotice = document.getElementById("adminNotice");

    let currentUser = null;

    // Auth
    registerBtn.onclick = () => {
      auth.createUserWithEmailAndPassword(emailInput.value, passwordInput.value)
        .then(() => alert("Compte créé avec succès."))
        .catch(err => alert(err.message));
    };

    loginBtn.onclick = () => {
      auth.signInWithEmailAndPassword(emailInput.value, passwordInput.value)
        .catch(err => alert(err.message));
    };

    logoutBtn.onclick = () => auth.signOut();

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        messagingDiv.style.display = "block";
        logoutBtn.style.display = "inline";
        currentUserEmail.textContent = user.email;

        // Marquage admin
        if (user.email === "mxrxndrv@gmail.com") {
          adminNotice.innerHTML = "<strong style='color:red;'>Connecté en tant qu'Administrateur</strong>";
        } else {
          adminNotice.innerHTML = "";
        }

        listenToMessages(user.email);
      } else {
        messagingDiv.style.display = "none";
        logoutBtn.style.display = "none";
        currentUser = null;
      }
    });

    // Envoi message
    chatForm.addEventListener("submit", function(e) {
      e.preventDefault();
      const message = messageInput.value;
      const recipient = recipientInput.value;

      db.collection("messages").add({
        sender: currentUser.email,
        recipient,
        message,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      messageInput.value = "";
    });

    // Afficher messages
    function listenToMessages(userEmail) {
      db.collection("messages")
        .where("recipient", "==", userEmail)
        .orderBy("timestamp")
        .onSnapshot(snapshot => {
          chatBox.innerHTML = "";
          snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement("div");
            div.textContent = `${data.sender} : ${data.message}`;
            chatBox.appendChild(div);
          });
        });
    }

    // Drag & drop
    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.classList.add("hover");
    });
    dropZone.addEventListener("dragleave", () => dropZone.classList.remove("hover"));
    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.classList.remove("hover");
      handleFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener("change", (e) => handleFiles(e.target.files));

    function handleFiles(files) {
      Array.from(files).forEach(file => {
        const maxSize = 50 * 1024 * 1024;
        if (file.size <= maxSize) {
          uploadFile(file);
        } else {
          const excess = file.size - maxSize;
          const mo = Math.ceil(excess / (10 * 1024 * 1024)) * 10;
          const price = (mo / 10) * 500;
          alert(`Le fichier "${file.name}" dépasse 50Mo.\nMontant à payer : ${price} Ar\nPayez via MVola au numéro 0340894299.`);
        }
      });
    }

    function uploadFile(file) {
      const ref = storage.ref(`uploads/${currentUser.uid}/${file.name}`);
      ref.put(file)
        .then(() => alert(`Fichier "${file.name}" envoyé avec succès.`))
        .catch(err => alert("Erreur : " + err.message));
    }
  </script>
</body>
</html><!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mirindra Chat</title>
  <style>
    #chat-box {
      border: 1px solid #ccc;
      height: 300px;
      overflow-y: scroll;
      padding: 10px;
      margin-bottom: 10px;
    }
    #dropZone {
      border: 2px dashed #ccc;
      padding: 20px;
      text-align: center;
      margin-bottom: 10px;
    }
    #dropZone.hover {
      border-color: #333;
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>

  <h1>Mirindra Chat</h1>
  <h3>Par Andrianarivelo Njara Mirindra Nirina</h3>

  <div id="auth">
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Mot de passe" required />
    <button id="registerBtn">Créer un compte</button>
    <button id="loginBtn">Se connecter</button>
    <button id="logoutBtn" style="display:none;">Déconnexion</button>
  </div>

  <div id="messaging" style="display:none;">
    <h3>Bienvenue, <span id="currentUserEmail"></span></h3>
    <div id="adminNotice"></div>

    <input type="text" id="recipient" placeholder="Destinataire (email)" required />
    <div id="chat-box"></div>

    <form id="chat-form">
      <input type="text" id="message" placeholder="Votre message" required />
      <button type="submit">Envoyer</button>
    </form>

    <input type="file" id="fileInput" multiple />
    <div id="dropZone">Glissez vos fichiers ici</div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "mxrxndrv756",
      authDomain: "mxrxndrv-messenger.mimi.com",
      projectId: "mxrxndrv-message",
      storageBucket: "mimi.com",
      messagingSenderId: "19215678",
      appId: "1:19215678:mimi:mxr12mi89"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const storage = firebase.storage();

    // DOM
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const registerBtn = document.getElementById("registerBtn");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const chatForm = document.getElementById("chat-form");
    const messageInput = document.getElementById("message");
    const recipientInput = document.getElementById("recipient");
    const chatBox = document.getElementById("chat-box");
    const fileInput = document.getElementById("fileInput");
    const dropZone = document.getElementById("dropZone");
    const messagingDiv = document.getElementById("messaging");
    const currentUserEmail = document.getElementById("currentUserEmail");
    const adminNotice = document.getElementById("adminNotice");

    let currentUser = null;

    // Auth
    registerBtn.onclick = () => {
      auth.createUserWithEmailAndPassword(emailInput.value, passwordInput.value)
        .then(() => alert("Compte créé avec succès."))
        .catch(err => alert(err.message));
    };

    loginBtn.onclick = () => {
      auth.signInWithEmailAndPassword(emailInput.value, passwordInput.value)
        .catch(err => alert(err.message));
    };

    logoutBtn.onclick = () => auth.signOut();

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        messagingDiv.style.display = "block";
        logoutBtn.style.display = "inline";
        currentUserEmail.textContent = user.email;

        // Marquage admin
        if (user.email === "mxrxndrv@gmail.com") {
          adminNotice.innerHTML = "<strong style='color:red;'>Connecté en tant qu'Administrateur</strong>";
        } else {
          adminNotice.innerHTML = "";
        }

        listenToMessages(user.email);
      } else {
        messagingDiv.style.display = "none";
        logoutBtn.style.display = "none";
        currentUser = null;
      }
    });

    // Envoi message
    chatForm.addEventListener("submit", function(e) {
      e.preventDefault();
      const message = messageInput.value;
      const recipient = recipientInput.value;

      db.collection("messages").add({
        sender: currentUser.email,
        recipient,
        message,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      messageInput.value = "";
    });

    // Afficher messages
    function listenToMessages(userEmail) {
      db.collection("messages")
        .where("recipient", "==", userEmail)
        .orderBy("timestamp")
        .onSnapshot(snapshot => {
          chatBox.innerHTML = "";
          snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement("div");
            div.textContent = `${data.sender} : ${data.message}`;
            chatBox.appendChild(div);
          });
        });
    }

    // Drag & drop
    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.classList.add("hover");
    });
    dropZone.addEventListener("dragleave", () => dropZone.classList.remove("hover"));
    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.classList.remove("hover");
      handleFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener("change", (e) => handleFiles(e.target.files));

    function handleFiles(files) {
      Array.from(files).forEach(file => {
        const maxSize = 50 * 1024 * 1024;
        if (file.size <= maxSize) {
          uploadFile(file);
        } else {
          const excess = file.size - maxSize;
          const mo = Math.ceil(excess / (10 * 1024 * 1024)) * 10;
          const price = (mo / 10) * 500;
          alert(`Le fichier "${file.name}" dépasse 50Mo.\nMontant à payer : ${price} Ar\nPayez via MVola au numéro 0340894299.`);
        }
      });
    }

    function uploadFile(file) {
      const ref = storage.ref(`uploads/${currentUser.uid}/${file.name}`);
      ref.put(file)
        .then(() => alert(`Fichier "${file.name}" envoyé avec succès.`))
        .catch(err => alert("Erreur : " + err.message));
    }
  </script>
</body>
</html><!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mirindra Chat</title>
  <style>
    #chat-box {
      border: 1px solid #ccc;
      height: 300px;
      overflow-y: scroll;
      padding: 10px;
      margin-bottom: 10px;
    }
    #dropZone {
      border: 2px dashed #ccc;
      padding: 20px;
      text-align: center;
      margin-bottom: 10px;
    }
    #dropZone.hover {
      border-color: #333;
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>

  <h1>Mirindra Chat</h1>
  <h3>Par Andrianarivelo Njara Mirindra Nirina</h3>

  <div id="auth">
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Mot de passe" required />
    <button id="registerBtn">Créer un compte</button>
    <button id="loginBtn">Se connecter</button>
    <button id="logoutBtn" style="display:none;">Déconnexion</button>
  </div>

  <div id="messaging" style="display:none;">
    <h3>Bienvenue, <span id="currentUserEmail"></span></h3>
    <div id="adminNotice"></div>

    <input type="text" id="recipient" placeholder="Destinataire (email)" required />
    <div id="chat-box"></div>

    <form id="chat-form">
      <input type="text" id="message" placeholder="Votre message" required />
      <button type="submit">Envoyer</button>
    </form>

    <input type="file" id="fileInput" multiple />
    <div id="dropZone">Glissez vos fichiers ici</div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "mxrxndrv756",
      authDomain: "mxrxndrv-messenger.mimi.com",
      projectId: "mxrxndrv-message",
      storageBucket: "mimi.com",
      messagingSenderId: "19215678",
      appId: "1:19215678:mimi:mxr12mi89"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const storage = firebase.storage();

    // DOM
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const registerBtn = document.getElementById("registerBtn");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const chatForm = document.getElementById("chat-form");
    const messageInput = document.getElementById("message");
    const recipientInput = document.getElementById("recipient");
    const chatBox = document.getElementById("chat-box");
    const fileInput = document.getElementById("fileInput");
    const dropZone = document.getElementById("dropZone");
    const messagingDiv = document.getElementById("messaging");
    const currentUserEmail = document.getElementById("currentUserEmail");
    const adminNotice = document.getElementById("adminNotice");

    let currentUser = null;

    // Auth
    registerBtn.onclick = () => {
      auth.createUserWithEmailAndPassword(emailInput.value, passwordInput.value)
        .then(() => alert("Compte créé avec succès."))
        .catch(err => alert(err.message));
    };

    loginBtn.onclick = () => {
      auth.signInWithEmailAndPassword(emailInput.value, passwordInput.value)
        .catch(err => alert(err.message));
    };

    logoutBtn.onclick = () => auth.signOut();

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        messagingDiv.style.display = "block";
        logoutBtn.style.display = "inline";
        currentUserEmail.textContent = user.email;

        // Marquage admin
        if (user.email === "mxrxndrv@gmail.com") {
          adminNotice.innerHTML = "<strong style='color:red;'>Connecté en tant qu'Administrateur</strong>";
        } else {
          adminNotice.innerHTML = "";
        }

        listenToMessages(user.email);
      } else {
        messagingDiv.style.display = "none";
        logoutBtn.style.display = "none";
        currentUser = null;
      }
    });

    // Envoi message
    chatForm.addEventListener("submit", function(e) {
      e.preventDefault();
      const message = messageInput.value;
      const recipient = recipientInput.value;

      db.collection("messages").add({
        sender: currentUser.email,
        recipient,
        message,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      messageInput.value = "";
    });

    // Afficher messages
    function listenToMessages(userEmail) {
      db.collection("messages")
        .where("recipient", "==", userEmail)
        .orderBy("timestamp")
        .onSnapshot(snapshot => {
          chatBox.innerHTML = "";
          snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement("div");
            div.textContent = `${data.sender} : ${data.message}`;
            chatBox.appendChild(div);
          });
        });
    }

    // Drag & drop
    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.classList.add("hover");
    });
    dropZone.addEventListener("dragleave", () => dropZone.classList.remove("hover"));
    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.classList.remove("hover");
      handleFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener("change", (e) => handleFiles(e.target.files));

    function handleFiles(files) {
      Array.from(files).forEach(file => {
        const maxSize = 50 * 1024 * 1024;
        if (file.size <= maxSize) {
          uploadFile(file);
        } else {
          const excess = file.size - maxSize;
          const mo = Math.ceil(excess / (10 * 1024 * 1024)) * 10;
          const price = (mo / 10) * 500;
          alert(`Le fichier "${file.name}" dépasse 50Mo.\nMontant à payer : ${price} Ar\nPayez via MVola au numéro 0340894299.`);
        }
      });
    }

    function uploadFile(file) {
      const ref = storage.ref(`uploads/${currentUser.uid}/${file.name}`);
      ref.put(file)
        .then(() => alert(`Fichier "${file.name}" envoyé avec succès.`))
        .catch(err => alert("Erreur : " + err.message));
    }
  </script>
</body>
</html><!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mirindra Chat</title>
  <style>
    #chat-box {
      border: 1px solid #ccc;
      height: 300px;
      overflow-y: scroll;
      padding: 10px;
      margin-bottom: 10px;
    }
    #dropZone {
      border: 2px dashed #ccc;
      padding: 20px;
      text-align: center;
      margin-bottom: 10px;
    }
    #dropZone.hover {
      border-color: #333;
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>

  <h1>Mirindra Chat</h1>
  <h3>Par Andrianarivelo Njara Mirindra Nirina</h3>

  <div id="auth">
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Mot de passe" required />
    <button id="registerBtn">Créer un compte</button>
    <button id="loginBtn">Se connecter</button>
    <button id="logoutBtn" style="display:none;">Déconnexion</button>
  </div>

  <div id="messaging" style="display:none;">
    <h3>Bienvenue, <span id="currentUserEmail"></span></h3>
    <div id="adminNotice"></div>

    <input type="text" id="recipient" placeholder="Destinataire (email)" required />
    <div id="chat-box"></div>

    <form id="chat-form">
      <input type="text" id="message" placeholder="Votre message" required />
      <button type="submit">Envoyer</button>
    </form>

    <input type="file" id="fileInput" multiple />
    <div id="dropZone">Glissez vos fichiers ici</div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "mxrxndrv756",
      authDomain: "mxrxndrv-messenger.mimi.com",
      projectId: "mxrxndrv-message",
      storageBucket: "mimi.com",
      messagingSenderId: "19215678",
      appId: "1:19215678:mimi:mxr12mi89"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const storage = firebase.storage();

    // DOM
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const registerBtn = document.getElementById("registerBtn");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const chatForm = document.getElementById("chat-form");
    const messageInput = document.getElementById("message");
    const recipientInput = document.getElementById("recipient");
    const chatBox = document.getElementById("chat-box");
    const fileInput = document.getElementById("fileInput");
    const dropZone = document.getElementById("dropZone");
    const messagingDiv = document.getElementById("messaging");
    const currentUserEmail = document.getElementById("currentUserEmail");
    const adminNotice = document.getElementById("adminNotice");

    let currentUser = null;

    // Auth
    registerBtn.onclick = () => {
      auth.createUserWithEmailAndPassword(emailInput.value, passwordInput.value)
        .then(() => alert("Compte créé avec succès."))
        .catch(err => alert(err.message));
    };

    loginBtn.onclick = () => {
      auth.signInWithEmailAndPassword(emailInput.value, passwordInput.value)
        .catch(err => alert(err.message));
    };

    logoutBtn.onclick = () => auth.signOut();

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        messagingDiv.style.display = "block";
        logoutBtn.style.display = "inline";
        currentUserEmail.textContent = user.email;

        // Marquage admin
        if (user.email === "mxrxndrv@gmail.com") {
          adminNotice.innerHTML = "<strong style='color:red;'>Connecté en tant qu'Administrateur</strong>";
        } else {
          adminNotice.innerHTML = "";
        }

        listenToMessages(user.email);
      } else {
        messagingDiv.style.display = "none";
        logoutBtn.style.display = "none";
        currentUser = null;
      }
    });

    // Envoi message
    chatForm.addEventListener("submit", function(e) {
      e.preventDefault();
      const message = messageInput.value;
      const recipient = recipientInput.value;

      db.collection("messages").add({
        sender: currentUser.email,
        recipient,
        message,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      messageInput.value = "";
    });

    // Afficher messages
    function listenToMessages(userEmail) {
      db.collection("messages")
        .where("recipient", "==", userEmail)
        .orderBy("timestamp")
        .onSnapshot(snapshot => {
          chatBox.innerHTML = "";
          snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement("div");
            div.textContent = `${data.sender} : ${data.message}`;
            chatBox.appendChild(div);
          });
        });
    }

    // Drag & drop
    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.classList.add("hover");
    });
    dropZone.addEventListener("dragleave", () => dropZone.classList.remove("hover"));
    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.classList.remove("hover");
      handleFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener("change", (e) => handleFiles(e.target.files));

    function handleFiles(files) {
      Array.from(files).forEach(file => {
        const maxSize = 50 * 1024 * 1024;
        if (file.size <= maxSize) {
          uploadFile(file);
        } else {
          const excess = file.size - maxSize;
          const mo = Math.ceil(excess / (10 * 1024 * 1024)) * 10;
          const price = (mo / 10) * 500;
          alert(`Le fichier "${file.name}" dépasse 50Mo.\nMontant à payer : ${price} Ar\nPayez via MVola au numéro 0340894299.`);
        }
      });
    }

    function uploadFile(file) {
      const ref = storage.ref(`uploads/${currentUser.uid}/${file.name}`);
      ref.put(file)
        .then(() => alert(`Fichier "${file.name}" envoyé avec succès.`))
        .catch(err => alert("Erreur : " + err.message));
    }
  </script>
</body>
</html><!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mirindra Chat</title>
  <style>
    #chat-box {
      border: 1px solid #ccc;
      height: 300px;
      overflow-y: scroll;
      padding: 10px;
      margin-bottom: 10px;
    }
    #dropZone {
      border: 2px dashed #ccc;
      padding: 20px;
      text-align: center;
      margin-bottom: 10px;
    }
    #dropZone.hover {
      border-color: #333;
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>

  <h1>Mirindra Chat</h1>
  <h3>Par Andrianarivelo Njara Mirindra Nirina</h3>

  <div id="auth">
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Mot de passe" required />
    <button id="registerBtn">Créer un compte</button>
    <button id="loginBtn">Se connecter</button>
    <button id="logoutBtn" style="display:none;">Déconnexion</button>
  </div>

  <div id="messaging" style="display:none;">
    <h3>Bienvenue, <span id="currentUserEmail"></span></h3>
    <div id="adminNotice"></div>

    <input type="text" id="recipient" placeholder="Destinataire (email)" required />
    <div id="chat-box"></div>

    <form id="chat-form">
      <input type="text" id="message" placeholder="Votre message" required />
      <button type="submit">Envoyer</button>
    </form>

    <input type="file" id="fileInput" multiple />
    <div id="dropZone">Glissez vos fichiers ici</div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "mxrxndrv756",
      authDomain: "mxrxndrv-messenger.mimi.com",
      projectId: "mxrxndrv-message",
      storageBucket: "mimi.com",
      messagingSenderId: "19215678",
      appId: "1:19215678:mimi:mxr12mi89"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const storage = firebase.storage();

    // DOM
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const registerBtn = document.getElementById("registerBtn");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const chatForm = document.getElementById("chat-form");
    const messageInput = document.getElementById("message");
    const recipientInput = document.getElementById("recipient");
    const chatBox = document.getElementById("chat-box");
    const fileInput = document.getElementById("fileInput");
    const dropZone = document.getElementById("dropZone");
    const messagingDiv = document.getElementById("messaging");
    const currentUserEmail = document.getElementById("currentUserEmail");
    const adminNotice = document.getElementById("adminNotice");

    let currentUser = null;

    // Auth
    registerBtn.onclick = () => {
      auth.createUserWithEmailAndPassword(emailInput.value, passwordInput.value)
        .then(() => alert("Compte créé avec succès."))
        .catch(err => alert(err.message));
    };

    loginBtn.onclick = () => {
      auth.signInWithEmailAndPassword(emailInput.value, passwordInput.value)
        .catch(err => alert(err.message));
    };

    logoutBtn.onclick = () => auth.signOut();

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        messagingDiv.style.display = "block";
        logoutBtn.style.display = "inline";
        currentUserEmail.textContent = user.email;

        // Marquage admin
        if (user.email === "mxrxndrv@gmail.com") {
          adminNotice.innerHTML = "<strong style='color:red;'>Connecté en tant qu'Administrateur</strong>";
        } else {
          adminNotice.innerHTML = "";
        }

        listenToMessages(user.email);
      } else {
        messagingDiv.style.display = "none";
        logoutBtn.style.display = "none";
        currentUser = null;
      }
    });

    // Envoi message
    chatForm.addEventListener("submit", function(e) {
      e.preventDefault();
      const message = messageInput.value;
      const recipient = recipientInput.value;

      db.collection("messages").add({
        sender: currentUser.email,
        recipient,
        message,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      messageInput.value = "";
    });

    // Afficher messages
    function listenToMessages(userEmail) {
      db.collection("messages")
        .where("recipient", "==", userEmail)
        .orderBy("timestamp")
        .onSnapshot(snapshot => {
          chatBox.innerHTML = "";
          snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement("div");
            div.textContent = `${data.sender} : ${data.message}`;
            chatBox.appendChild(div);
          });
        });
    }

    // Drag & drop
    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.classList.add("hover");
    });
    dropZone.addEventListener("dragleave", () => dropZone.classList.remove("hover"));
    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.classList.remove("hover");
      handleFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener("change", (e) => handleFiles(e.target.files));

    function handleFiles(files) {
      Array.from(files).forEach(file => {
        const maxSize = 50 * 1024 * 1024;
        if (file.size <= maxSize) {
          uploadFile(file);
        } else {
          const excess = file.size - maxSize;
          const mo = Math.ceil(excess / (10 * 1024 * 1024)) * 10;
          const price = (mo / 10) * 500;
          alert(`Le fichier "${file.name}" dépasse 50Mo.\nMontant à payer : ${price} Ar\nPayez via MVola au numéro 0340894299.`);
        }
      });
    }

    function uploadFile(file) {
      const ref = storage.ref(`uploads/${currentUser.uid}/${file.name}`);
      ref.put(file)
        .then(() => alert(`Fichier "${file.name}" envoyé avec succès.`))
        .catch(err => alert("Erreur : " + err.message));
    }
  </script>
</body>
  </html><!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mirindra Chat</title>
  <style>
    #chat-box {
      border: 1px solid #ccc;
      height: 300px;
      overflow-y: scroll;
      padding: 10px;
      margin-bottom: 10px;
    }
    #dropZone {
      border: 2px dashed #ccc;
      padding: 20px;
      text-align: center;
      margin-bottom: 10px;
    }
    #dropZone.hover {
      border-color: #333;
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>

  <h1>Mirindra Chat</h1>
  <h3>Par Andrianarivelo Njara Mirindra Nirina</h3>

  <div id="auth">
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Mot de passe" required />
    <button id="registerBtn">Créer un compte</button>
    <button id="loginBtn">Se connecter</button>
    <button id="logoutBtn" style="display:none;">Déconnexion</button>
  </div>

  <div id="messaging" style="display:none;">
    <h3>Bienvenue, <span id="currentUserEmail"></span></h3>
    <div id="adminNotice"></div>

    <input type="text" id="recipient" placeholder="Destinataire (email)" required />
    <div id="chat-box"></div>

    <form id="chat-form">
      <input type="text" id="message" placeholder="Votre message" required />
      <button type="submit">Envoyer</button>
    </form>

    <input type="file" id="fileInput" multiple />
    <div id="dropZone">Glissez vos fichiers ici</div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "mxrxndrv756",
      authDomain: "mxrxndrv-messenger.mimi.com",
      projectId: "mxrxndrv-message",
      storageBucket: "mimi.com",
      messagingSenderId: "19215678",
      appId: "1:19215678:mimi:mxr12mi89"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const storage = firebase.storage();

    // DOM
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const registerBtn = document.getElementById("registerBtn");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const chatForm = document.getElementById("chat-form");
    const messageInput = document.getElementById("message");
    const recipientInput = document.getElementById("recipient");
    const chatBox = document.getElementById("chat-box");
    const fileInput = document.getElementById("fileInput");
    const dropZone = document.getElementById("dropZone");
    const messagingDiv = document.getElementById("messaging");
    const currentUserEmail = document.getElementById("currentUserEmail");
    const adminNotice = document.getElementById("adminNotice");

    let currentUser = null;

    // Auth
    registerBtn.onclick = () => {
      auth.createUserWithEmailAndPassword(emailInput.value, passwordInput.value)
        .then(() => alert("Compte créé avec succès."))
        .catch(err => alert(err.message));
    };

    loginBtn.onclick = () => {
      auth.signInWithEmailAndPassword(emailInput.value, passwordInput.value)
        .catch(err => alert(err.message));
    };

    logoutBtn.onclick = () => auth.signOut();

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        messagingDiv.style.display = "block";
        logoutBtn.style.display = "inline";
        currentUserEmail.textContent = user.email;

        // Marquage admin
        if (user.email === "mxrxndrv@gmail.com") {
          adminNotice.innerHTML = "<strong style='color:red;'>Connecté en tant qu'Administrateur</strong>";
        } else {
          adminNotice.innerHTML = "";
        }

        listenToMessages(user.email);
      } else {
        messagingDiv.style.display = "none";
        logoutBtn.style.display = "none";
        currentUser = null;
      }
    });

    // Envoi message
    chatForm.addEventListener("submit", function(e) {
      e.preventDefault();
      const message = messageInput.value;
      const recipient = recipientInput.value;

      db.collection("messages").add({
        sender: currentUser.email,
        recipient,
        message,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      messageInput.value = "";
    });

    // Afficher messages
    function listenToMessages(userEmail) {
      db.collection("messages")
        .where("recipient", "==", userEmail)
        .orderBy("timestamp")
        .onSnapshot(snapshot => {
          chatBox.innerHTML = "";
          snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement("div");
            div.textContent = `${data.sender} : ${data.message}`;
            chatBox.appendChild(div);
          });
        });
    }

    // Drag & drop
    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.classList.add("hover");
    });
    dropZone.addEventListener("dragleave", () => dropZone.classList.remove("hover"));
    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.classList.remove("hover");
      handleFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener("change", (e) => handleFiles(e.target.files));

    function handleFiles(files) {
      Array.from(files).forEach(file => {
        const maxSize = 50 * 1024 * 1024;
        if (file.size <= maxSize) {
          uploadFile(file);
        } else {
          const excess = file.size - maxSize;
          const mo = Math.ceil(excess / (10 * 1024 * 1024)) * 10;
          const price = (mo / 10) * 500;
          alert(`Le fichier "${file.name}" dépasse 50Mo.\nMontant à payer : ${price} Ar\nPayez via MVola au numéro 0340894299.`);
        }
      });
    }

    function uploadFile(file) {
      const ref = storage.ref(`uploads/${currentUser.uid}/${file.name}`);
      ref.put(file)
        .then(() => alert(`Fichier "${file.name}" envoyé avec succès.`))
        .catch(err => alert("Erreur : " + err.message));
    }
  </script>
</body>
</html>
